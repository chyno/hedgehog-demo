<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- <script src="./hedgehog.js"></script>
    <script src="./firebase.js"></script> -->
    <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase-app.js"></script>

    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.10.0/firebase-firestore.js"></script>
    <script src="./dist/elmapp.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
    <script src="./browser.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="./style.css" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
  </head>
  <body>
    <div id="elm"></div>

    <script async type="module">
      import { hedgehog } from "./hedgehog.js";
        
        let app = Elm.Main.init({
          flags: "Hello",
          node: document.getElementById("elm")
        });
  
        app.ports.loginUser.subscribe(function(data) {
          hedgehog
             .login(data.userName, data.password)
             .then(
               () => {
                  app.ports.loginResult.send({
                  address: hedgehog.getWallet().getAddressString(),
                  isLoggedIn: isLoggedIn(),
                  message: 'Success'});
                }
              ,(e) => {
                app.ports
                .loginResult
                .send({
                  address: '',
                  isLoggedIn: false,
                  message: e.message
                });
              });
  
        app.ports.logoutUser.subscribe(function() { hedgehog.logout(); });
  
        function isLoggedIn() {
            if (hedgehog.isLoggedIn()) {
              return true;
            } else {
              return  hedgehog &&
                      hedgehog.walletExistsLocally &&
                      hedgehog.walletExistsLocally();
            }
          }
    </script>
  </body>
</html>
